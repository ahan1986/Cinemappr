<!DOCTYPE html>
<html>

<head>
    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/momentjs/2.12.0/moment.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
</head>

<body>
    <p>Hola!</p>

    <form action="/action_page.php">
        <!-- input for zipcode that holds only 5 digits only-->
        <input oninput="javascript: if (this.value.length > this.maxLength) this.value = this.value.slice(0, this.maxLength);" type="number"
            maxlength="5" id="zipcode">
        <!-- input for date -->
        <p>Date:
            <input type="date" id="date"> </p>
        <!-- button to start -->
        <button type="button" id='start'>Search Me...</button>
    </form>

    <div id="theatreHere"></div>

    <script>
        // created this function to get rid of the error. To use google maps, you need to call this to define initMap that is called in the google maps script on the bottom.
        function initMap() {};// this is for google maps. This will cause error if this function is not in the global scope

        $("#start").on("click", function () {
            event.preventDefault();
            var zip1 = $("#zipcode").val();
            var date = $("#date").val();
            console.log(zip1);
            console.log(date);

            var queryUrl1 = 'http://data.tmsapi.com/v1.1/movies/showings?startDate=' + date + '&zip=' + zip1 + '&api_key=8dyfezutfxys5435q4ehcqkp';
            $.ajax({
                method: "GET",
                url: queryUrl1
            }).then(function (response1) {
                
                var uniqueTheatreArray = [];
                var displayObject = new Object();
                var theaterData = [];

                for (var i = 0; i < response1.length; i++) {

                    var movieTitles = response1[i].title; // Get name of movie

                    for (var j = 0; j < response1[i].showtimes.length; j++) {

                        var listOfTheatreNames = response1[i].showtimes[j].theatre.name; // Get name of theater
                        var times = JSON.stringify(response1[i].showtimes[j].dateTime.match(/T.*/)).slice(3, 8); // Get showtime
                        var timesFormat = moment(times, "H:mm").format("LT"); // Parse showtime format

                        // Push properties theater, showtime, and time to var theaterData
                        theaterData.push({ theater: listOfTheatreNames, showtime: timesFormat, title: movieTitles} );
                    }
                }
                
                for(var key in theaterData) {
                    if(displayObject[theaterData[key].names]=== undefined && displayObject[theaterData[key].titles] === undefined){
                        displayObject[theaterData[key].names] = theaterData[key].names+theaterData[key].titles;
                    }
                    
                }

        console.log(theaterData);

        //ES6 to separate out the duplicates
        // var uniqueTheatre = a => uniqueTheatreArray.push([...new Set(a)]);
        // uniqueTheatre(movieTheatreNames);

        //going to append each theatre into a div
        // for (var i =0; i<uniqueTheatreArray.length; i++) {
        //     $("#theatreHere").append(uniqueTheatreArray[i]);
        // }

        //google maps api trying to get lat and long
        var key = 'AIzaSyASKnjScxmEcAhuUUchHloDaPz3X3q7KV0';
        var queryUrl = 'https://maps.googleapis.com/maps/api/geocode/json?address=1600+Amphitheatre+Parkway,+Mountain+View,+CA&key=' + key;

        $.ajax({
            method: "GET",
            url: queryUrl
        }).then(function (response) {


        }) //==================END OF GOOGLE MAPS API AJAX===================================

            }) //==================END OF GRACENOTE DEVELOPER API AJAX===================================

        })//=====================END OF THE CLICK EVENT ===============================


    </script>
    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBv7taMhfo9vK1l-HC1iBruuwsods1K5Hg&callback=initMap"></script>
</body>

</html>